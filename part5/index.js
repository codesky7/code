define(["jquery","knockout","config/config","service","underscore","config/menu","logout"],function(e,n,t,o,i,r,a){function s(){return setInterval(function(){if(!o.getStatusInfo().isLoggedIn)return void _();lastLoginStatus=o.getStatusInfo().isLoggedIn?"1":"0"},1e3)}function u(){function i(){var e=o.getLoginData(),n=o.getLoginStatus(),t=u(n,e);t==l.LOADING?addTimeout(i,500):(f.pageState(t),f.pinNumber(e.pinnumber),f.pukNumber(e.puknumber)),r()}function r(){setTimeout(function(){var n=e("#txtPwd:visible"),t=e("#txtPIN:visible"),o=e("#txtPUK:visible");n.length>0?n.focus():t.length>0?t.focus():o.length>0&&o.focus()},100)}function u(e,n){return t.LOGIN_THEN_CHECK_PIN?c(e,n):_(e,n)}function c(n,o){if("loggedIn"==n.status)return"modem_waitpin"==i?l.WAIT_PIN:"modem_waitpuk"!=i&&0!=o.pinnumber||0==o.puknumber?0!=o.puknumber&&"modem_sim_destroy"!=i||"modem_sim_undetected"==i||"modem_undetected"==i?l.LOGGEDIN:l.PUK_LOCKED:l.WAIT_PUK;var i=o.modem_main_state;return-1!=e.inArray(i,t.TEMPORARY_MODEM_MAIN_STATE)?l.LOADING:l.LOGIN}function _(n,o){if("loggedIn"==n.status)return l.LOGGEDIN;var i=o.modem_main_state;return-1!=e.inArray(i,t.TEMPORARY_MODEM_MAIN_STATE)?l.LOADING:"modem_waitpin"==i?l.WAIT_PIN:"modem_waitpuk"!=i&&0!==parseInt(o.pinnumber)||0==parseInt(o.puknumber)?0!==parseInt(o.puknumber)&&"modem_sim_destroy"!=i||"modem_sim_undetected"==i||"modem_undetected"==i?l.LOGIN:l.PUK_LOCKED:l.WAIT_PUK}var f=this;f.visibility=t.INCLUDE_MOBILE?"visible":"hidden";var g=o.getLoginData(),I=o.getLoginStatus();f.password=n.observable(),f.PIN=n.observable(),f.PUK=n.observable(),f.newPIN=n.observable(),f.confirmPIN=n.observable(),f.pinNumber=n.observable(g.pinnumber),f.pukNumber=n.observable(g.puknumber),f.loginCount=n.observable(0),f.loginSecuritySupport=n.observable(t.LOGIN_SECURITY_SUPPORT),f.leftSeconds=n.observable(0),f.accountLocked=n.computed(function(){return f.loginCount()==t.MAX_LOGIN_COUNT&&"-1"!=f.leftSeconds()}),f.uiLoginTimer=n.observable(300),f.leftUnlockTime=n.computed(function(){f.leftSeconds();var e=transSecond2Time(f.uiLoginTimer());return e.substring(e.indexOf(":")+1,e.length)}),f.showEntrance=n.observable(!1),f.sharePathInvalid=n.observable(!1),t.SD_CARD_SUPPORT&&o.getSDConfiguration({},function(e){f.showEntrance("1"==e.sd_status&&"1"==e.share_status&&"0"==e.sd_mode),f.showEntrance()&&o.checkFileExists({path:e.share_file},function(e){"exist"==e.status?f.sharePathInvalid(!1):f.sharePathInvalid(!0)})});var p=u(I,g);f.pageState=n.observable(p),p==l.LOADING&&addTimeout(i,500),r(),f.login=function(){if(t.ACCESSIBLE_ID_SUPPORT&&(""==rd0||""==rd1)){var n=o.getLanguage();rd0=n.rd_params0,rd1=n.rd_params1}if(t.LOGIN_SECURITY_SUPPORT&&f.accountLocked())return showAlert("password_error_account_lock_time",function(){r()}),!1;f.pageState(l.LOADING),window.clearInterval(m),o.login({password:f.password()},function(n){if(setTimeout(function(){m=s()},1300),"5"==n.result)showAlert("lcd_loginfo",function(){r()}),f.pageState(l.LOGIN);else if(n.result){f.pageState(l.LOGGEDIN),t.LOGIN_SECURITY_SUPPORT&&(f.loginCount(0),f.uiLoginTimer(300),clearInterval(d)),e("#container").empty();var i=window.location.href;if(-1!=window.location.href.indexOf("?no_connect")){o.getStatusInfo();t.HAS_RJ45&&o.getEthernetConnect().is_rj45_connected?window.location.href=i.slice(0,i.indexOf("?no_connect"))+"#ethernet_settings":window.location.href=i.slice(0,i.indexOf("?no_connect"))+"#home"}else-1!=window.location.href.indexOf("?flow_beyond")?window.location.href=i.slice(0,i.indexOf("?flow_beyond"))+"#traffic_alert":-1!=window.location.href.indexOf("?fota_upgrade")?window.location.href=i.slice(0,i.indexOf("?fota_upgrade"))+"#ota_update":window.location.hash="#home";a.init()}else f.password(""),t.LOGIN_SECURITY_SUPPORT?f.checkLoginData(function(){f.loginCount()==t.MAX_LOGIN_COUNT?(showAlert("password_error_five_times",function(){r()}),f.startLoginLockInterval()):isNaN(f.loginCount())||showAlert({msg:"password_error_left",params:[t.MAX_LOGIN_COUNT-f.loginCount()]},function(){r()})}):showAlert("password_error",function(){r()}),f.pageState(l.LOGIN)})},f.startLoginLockInterval=function(){d=setInterval(function(){o.getLoginData({},function(e){(e.login_lock_time<=0||5==e.psw_fail_num_str)&&(f.loginCount(0),clearInterval(d)),f.leftSeconds()!=e.login_lock_time?(f.leftSeconds(e.login_lock_time),f.uiLoginTimer(e.login_lock_time)):f.uiLoginTimer(f.uiLoginTimer()>0?f.uiLoginTimer()-1:0)})},1e3)},f.checkLoginData=function(n){o.getLoginData({},function(o){var i=parseInt(o.psw_fail_num_str,10);f.loginCount(t.MAX_LOGIN_COUNT-i),f.leftSeconds(o.login_lock_time),f.uiLoginTimer(o.login_lock_time),e.isFunction(n)?n():f.loginCount()==t.MAX_LOGIN_COUNT&&f.startLoginLockInterval()})},f.checkLoginData(),f.enterPIN=function(){f.pageState(l.LOADING);var e=f.PIN();o.enterPIN({PinNumber:e},function(e){e.result?i():(showAlert("pin_error",function(){i()}),f.PIN(""))})},f.enterPUK=function(){f.pageState(l.LOADING);var e=f.newPIN(),n=(f.confirmPIN(),{});n.PinNumber=e,n.PUKNumber=f.PUK(),o.enterPUK(n,function(e){e.result?i():(showAlert("puk_error",function(){i()}),f.PUK(""),f.newPIN(""),f.confirmPIN(""))})}}function c(){var i=o.getStatusInfo();-1!=window.location.href.indexOf("?no_connect")?t.HAS_RJ45&&o.getEthernetConnect().is_rj45_connected?showPromptNoImg("pppoe_error_jump"):"modem_sim_undetected"==i.simStatus?showPromptNoImg("no_simcard_jump"):"modem_sim_destroy"==i.simStatus||"modem_destroy"==i.simStatus?showPromptNoImg("invalid_simcard_jump"):"modem_imsi_waitnck"==i.simStatus||"modem_waitpin"==i.simStatus||"modem_waitpuk"==i.simStatus?showPromptNoImg("locked_simcard_jump"):"0"==i.ppp_dial_conn_fail_counter||""==i.ppp_dial_conn_fail_counter?showPromptNoImg("no_connect_jump"):showPromptNoImg("connect_failed_jump"):-1!=window.location.href.indexOf("?flow_beyond")?showPromptNoImg("flow_beyond_jump",function(){o.setRedirectOff()}):-1!=window.location.href.indexOf("?fota_upgrade")&&showPromptNoImg("fota_upgrade_jump",function(){o.setRedirectOff()});var r=e("#container")[0];n.cleanNode(r);var a=new u;n.applyBindings(a,r),e("#frmLogin").validate({submitHandler:function(){a.login()},rules:{txtPwd:"login_password_length_check"}}),e("#frmPIN").validate({submitHandler:function(){a.enterPIN()},rules:{txtPIN:"pin_check"}}),e("#frmPUK").validate({submitHandler:function(){a.enterPUK()},rules:{txtNewPIN:"pin_check",txtConfirmPIN:{equalToPin:"#txtNewPIN"},txtPUK:"puk_check"}})}function _(){if(window.location.hash!=t.defaultRoute&&-1==i.indexOf(t.GUEST_HASH,window.location.hash))if(manualLogout||"1"!=lastLoginStatus){if("UNREAL"==lastLoginStatus)return;window.location="index.html"}else manualLogout=!1,lastLoginStatus="UNREAL",showAlert("need_login_again",function(){window.location="index.html"})}var l={LOGIN:0,WAIT_PIN:1,WAIT_PUK:2,PUK_LOCKED:3,LOGGEDIN:4,LOADING:5},m=s(),d=0;return{init:c,gotoLogin:_}});
//# sourceMappingURL=../sourcemaps/login.js.map
